<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Produits</title>
</head>
<body>
    <h1>Test des donn√©es de produits</h1>
    <button onclick="testProduits()">Tester les produits</button>
    <button onclick="creerProduits()">Cr√©er les produits de test</button>
    <div id="resultat"></div>

    <script>
        function testProduits() {
            const resultat = document.getElementById('resultat');
            resultat.innerHTML = '<h2>Test des produits...</h2>';
            
            // V√©rifier le localStorage
            const storeData = localStorage.getItem('gestalis_produits_services');
            console.log('üì¶ Donn√©es du store:', storeData);
            
            if (storeData) {
                try {
                    const produits = JSON.parse(storeData);
                    console.log('‚úÖ Produits pars√©s:', produits);
                    console.log('üìä Nombre de produits:', produits.length);
                    
                    resultat.innerHTML += `<p>‚úÖ ${produits.length} produits trouv√©s</p>`;
                    
                    // Tester la recherche
                    const query = 'carburant';
                    const filtered = produits.filter(p => 
                        p.actif && (
                            p.designation?.toLowerCase().includes(query.toLowerCase()) ||
                            p.code?.toLowerCase().includes(query.toLowerCase()) ||
                            p.description?.toLowerCase().includes(query.toLowerCase())
                        )
                    );
                    
                    console.log('üîç R√©sultats de recherche pour "carburant":', filtered);
                    resultat.innerHTML += `<p>üîç Recherche "carburant": ${filtered.length} r√©sultats</p>`;
                    
                    // Afficher les produits
                    produits.forEach(produit => {
                        resultat.innerHTML += `<div style="border: 1px solid #ccc; margin: 5px; padding: 10px;">
                            <strong>${produit.code}</strong> - ${produit.designation} (${produit.unite}) - ${produit.prixUnitaire}‚Ç¨
                        </div>`;
                    });
                    
                } catch (error) {
                    console.error('‚ùå Erreur parsing:', error);
                    resultat.innerHTML += `<p>‚ùå Erreur parsing: ${error.message}</p>`;
                }
            } else {
                console.log('‚ùå Aucune donn√©e trouv√©e dans le store');
                resultat.innerHTML += '<p>‚ùå Aucune donn√©e trouv√©e dans le store</p>';
            }
        }

        function creerProduits() {
            const resultat = document.getElementById('resultat');
            resultat.innerHTML = '<h2>Cr√©ation des produits de test...</h2>';
            
            const produitsTest = [
                {
                    id: 1,
                    code: 'CARB-001',
                    designation: 'Carburant Diesel',
                    categorie: 'Carburant',
                    unite: 'L',
                    prixUnitaire: 1.85,
                    description: 'Carburant diesel pour engins de chantier',
                    actif: true,
                    dateCreation: new Date().toISOString()
                },
                {
                    id: 2,
                    code: 'TELECOM-001',
                    designation: 'Abonnement t√©l√©phonie mobile',
                    categorie: 'T√©l√©com',
                    unite: 'Mois',
                    prixUnitaire: 45.00,
                    description: 'Forfait mobile illimit√© pour √©quipe chantier',
                    actif: true,
                    dateCreation: new Date().toISOString()
                },
                {
                    id: 3,
                    code: 'TRANS-001',
                    designation: 'Transport de mat√©riaux',
                    categorie: 'Transport',
                    unite: 'Km',
                    prixUnitaire: 0.85,
                    description: 'Transport de mat√©riaux par camion',
                    actif: true,
                    dateCreation: new Date().toISOString()
                },
                {
                    id: 4,
                    code: 'MAT-001',
                    designation: 'Ciment Portland',
                    categorie: 'Mat√©riel',
                    unite: 'T',
                    prixUnitaire: 120.00,
                    description: 'Ciment Portland 32.5 pour construction',
                    actif: true,
                    dateCreation: new Date().toISOString()
                },
                {
                    id: 5,
                    code: 'SERV-001',
                    designation: 'Location d\'engins',
                    categorie: 'Services',
                    unite: 'Jour',
                    prixUnitaire: 350.00,
                    description: 'Location d\'engins de chantier',
                    actif: true,
                    dateCreation: new Date().toISOString()
                }
            ];
            
            // Sauvegarder dans le localStorage
            localStorage.setItem('gestalis_produits_services', JSON.stringify(produitsTest));
            
            console.log('‚úÖ Donn√©es de test cr√©√©es :', produitsTest.length, 'produits');
            resultat.innerHTML += `<p>‚úÖ ${produitsTest.length} produits de test cr√©√©s</p>`;
            
            // Tester imm√©diatement
            testProduits();
        }
    </script>
</body>
</html>
